<div class="modal fade" id="newVehicleModal" tabindex="-1" aria-labelledby="newVehicleModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h1 class="modal-title fs-5" id="newVehicleModalLabel">New Vehicle</h1>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <form id="create-vehicle">
                <div class="modal-body">
                    <div class="row">
                        <div class="form-group mb-3 col-sm-6">
                            <label for="type">Type</label>
                            <select class="form-control" id="type" name="type" required>
                                <option value="" disabled selected>select</option>
                                <option value="car">Car</option>
                                <option value="suv">SUV</option>
                                <option value="van">Van</option>
                                <option value="truck">Truck</option>
                            </select>
                        </div>
                        
                        <div class="form-group mb-3 col-sm-6">
                            <label for="category">Category</label>
                            <select class="form-control" id="category" name="category" required>
                                <option value="" disabled selected>select</option>
                                <option value="compact">Compact</option>
                                <option value="standard">Standard</option>
                                <option value="intermediate">Intermediate</option>
                                <option value="full-size">Full-size</option>
                            </select>
                        </div>
                    </div>

                    <div class="form-group mb-3">
                        <label for="imageUrl">Image URL</label>
                        <input type="text" class="form-control" id="branch" name="imageUrl" required>
                    </div>

                    <div class="form-group mb-3">
                        <label for="branch">Branch</label>
                        <select class="form-control" id="branch" name="branch" required>
                            <option value="" disabled selected>Select</option>
                            <option value="montreal">Montreal</option>
                            <option value="toronto">Toronto</option>
                            <option value="winnipeg">Winnipeg</option>
                            <option value="calgary">Calgary</option>
                            <option value="vancouver">Vancouver</option>
                        </select>
                    </div>

                    <div class="row align-items-center">
                        <div class="form-group mb-3 col-sm-6">
                            <label for="hourlyPrice">Hourly Rate</label>
                            <input type="number" class="form-control" id="hourlyPrice" name="hourlyPrice" required min="0" step=".01">
                        </div>
                        <div class="form-group mb-3 col-sm-6">
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" id="available" name="available">
                                <label class="form-check-label" for="available">
                                    Available
                                </label>
                            </div>
                        </div>
                    </div>

                    <div class="form-group mb-3">
                        <label for="make">Manufacturer</label>
                        <input type="text" class="form-control" id="make" name="make">
                    </div>
                    <div class="form-group mb-3">
                        <label for="model">Model</label>
                        <input type="text" class="form-control" id="model" name="model">
                    </div>

                    <div class="row">
                        <div class="form-group mb-3 col-sm-6">
                            <label for="year">Year</label>
                            <input type="number" class="form-control" id="year" name="year">
                        </div>
                        <div class="form-group mb-3 col-sm-6">
                            <label for="colour">Colour</label>
                            <input type="text" class="form-control" id="colour" name="colour">
                        </div>
                    </div>
    
                    <div class="row">
                        <div class="form-group mb-3 col-sm-6">
                            <label for="seats">Number of Seats</label>
                            <input type="number" class="form-control" id="seats" name="seats">
                        </div>
        
                        <div class="form-group mb-3 col-sm-6">
                            <label for="doors">Number of Doors</label>
                            <input type="number" class="form-control" id="doors" name="doors">
                        </div>
                    </div>
    
                    <div class="form-group mb-3">
                        <label for="mileage">Mileage (km)</label>
                        <input type="number" class="form-control" id="mileage" name="mileage">
                    </div>
    
                    
                    <div class="row align-items-center">
                        <div class="form-group mb-3 col-sm-6">
                            <label for="engineType">Engine Type</label>
                            <select class="form-control" id="engineType" name="engineType">
                                <option value="" disabled selected>select</option>
                                <option value="gas">Gas</option>
                                <option value="electric">Electric</option>
                                <option value="hybrid">Hybrid</option>
                            </select>
                        </div>

                        <div class="form-group mb-3 col-sm-6">
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" id="automatic" name="automatic">
                                <label class="form-check-label" for="automatic">
                                    Automatic
                                </label>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-dark" data-bs-dismiss="modal">Close</button>
                    <button type="submit" class="btn btn-success">Submit</button>
                    <!-- <button type="button" class="btn btn-primary">Save changes</button> -->
                </div>
            </form>
        </div>
    </div>
</div>
<script>
    const form = document.querySelector('#create-vehicle');
    const modal = document.getElementById('newVehicleModal');
    const bsModal = new bootstrap.Modal(modal);

    form.addEventListener('submit', (e) => {
        e.preventDefault();
        const formData = new FormData(form);
        const requestBody = {
            type: formData.get('type'),
            category: formData.get('category'),
            imageUrl: formData.get('imageUrl'),
            branch: formData.get('branch'),
            available: formData.get('available') === "on",
            hourlyPrice: formData.get('hourlyPrice'),
            details: {
                make: formData.get('make'),
                model: formData.get('model'),
                year: formData.get('year'),
                colour: formData.get('colour'),
                seats: formData.get('seats'),
                doors: formData.get('doors'),
                mileage: formData.get('mileage'),
                isAutomatic: formData.get('automatic') === "on",
                engineType: formData.get('engineType'),
            }
    
        };
        fetch('/vehicles', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify(requestBody),
        })
        .then(response => {
            if (!response.ok) {
                throw new Error('Network error.');
            }
            return response.text();
        })
        .then(html => {
            const vehicleContainer = document.createElement('div');
            vehicleContainer.className = 'col-12 col-md-6 col-lg-4 mb-3';
            vehicleContainer.innerHTML = html;
            document.querySelector("#vehicle-list").appendChild(vehicleContainer);
            document.querySelector("#toast").notify('Successfully created vehicle.');

            bsModal.hide();
            form.reset();
        })
        .catch((error) => {
            console.error('Error:', error);
            document.querySelector("#toast").caution('Failed to create vehicle.');
        });
    });
</script>