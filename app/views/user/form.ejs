<form action="/users<%= user ? `/${user._id}/update` : '' %>" method="POST">
    <div class="mb-3">
        <label for="name" class="form-label">Name</label>
        <input
            value = "<%= user ? user.name : '' %>"
            type="text"
            class="form-control"
            id="name"
            name="name"
            required
        >
    </div>
    <div class="row">
        <div class="mb-3 col-sm-8">
            <label for="email" class="form-label">Email</label>
            <input
                value = "<%= user ? user.email : '' %>"
                type="email"
                class="form-control"
                id="email"
                name="email"
                required
            >
        </div>
        <div class="mb-3 col-sm-4">
            <label for="age" class="form-label">Age</label>
            <input
                value = "<%= user ? user.age : '' %>"
                type="number"
                class="form-control"
                id="age" 
                name="age"
                required
            >
        </div>
    </div>
    <div class="mb-3">
        <label for="address" class="form-label">Home Address</label>
        <input
            value = "<%= user ? user.address : '' %>"
            type="text"
            class="form-control"
            id="address"
            name="address"
            required
        >
    </div>
    <% if (!user) { %>
        <div class="mb-3">
            <label for="hash" class="form-label">Password</label>
            <input type="password" class="form-control" id="hash" name="hash" required>
        </div>
    <% } %>
    <div class="d-flex justify-content-between">
        <a href="/<%= user ? 'logout' : 'login' %>" class=""><%= user ? 'Logout' : 'Login' %></a>

        <div>
            <% if (user) { %>
            <button id="delete-account" class="btn btn-danger">Delete</button>
            <% } %>
            <button type="submit" class="btn btn-success"><%= user ? 'Update' : 'Sign Up' %></button>
        </div>
    </div>
</form>

<% if (user) { %>
<script>
    document.querySelector('#delete-account').addEventListener('click', (e) => {
        e.preventDefault();
        fetch(`/users/<%= user._id %>`, {
            method: 'DELETE',
        })
            .then((response) => {
                if (response.ok) {
                    var baseUrl = window.location.protocol + "//" + window.location.host;
                    window.location.href = baseUrl;
                } else {
                    document
                        .querySelector('#toast')
                        .caution('Could not delete user.');
                }
            })
            .catch((error) => {
                console.error('Error:', error);
            });
    });
</script>
<% } %>
